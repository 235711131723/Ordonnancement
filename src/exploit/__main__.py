#!/usr/bin/env python3

import argparse
from exploit.task import Task
from exploit.instruction import Assign, Add, Sub
from exploit.system import System
from exploit.variable import Variable

def parse_args():
    parser = argparse.ArgumentParser()
    args = parser.parse_args()
    return args

def main():
    args = parse_args()

    """
    -------------
    T1 || T2:
        x = 10 ; y = 22 || z = 40
    -------------
    T3:
        x = 40
    -------------
    T4 || T5:
        x = 40 || y = 40
    xx || T6:
               || z = x + y
    """

    try:
        """
        t1 = Task(instructions=[
            Assign('x', 10),
            Assign('y', 22),
        ])

        t2 = Task(instructions=[
            Assign('z', 40)
        ], dependencies=[t1])

        ##############################
        # T3
        ##############################
        t3 = Task(instructions=[
            Assign('x', 40)
        ], dependencies=[t1])

        t4 = Task(instructions=[
            Add(10, 10, 'x')
        ], dependencies=[t3])

        ##############################
        # Right shit
        ##############################
        t5 = Task(instructions=[
            Assign('y', 1000)
        ], dependencies=[t2])

        t6 = Task(instructions=[
            Assign('t', 3000)
        ], dependencies=[t2])

        t7 = Task(instructions=[
            Assign('t', 6000)
        ], dependencies=[t5, t6])
        """

        t1 = Task(instructions=[
            Assign('x', 1)
        ], dependencies=[])
        t2 = Task(instructions=[
            Assign('y', 2)
        ], dependencies=[t1])
        t3 = Task(instructions=[
            Add('x', 'y', 'z')
        ], dependencies=[t1, t2])

        s = System(tasks=Task.Tasks)
        print(list(s.get_layers()))
        s.draw()
    except (RuntimeError, ValueError) as e:
        print('ERREUR :', e)
        print('ERREUR :', e.__doc__)

if __name__ == '__main__':
    main()