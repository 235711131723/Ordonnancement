#!/usr/bin/env python3

from rich import print
import argparse
import toposort

from exploit.task import Task
from exploit.instruction import Assign, Add, Sub
from exploit.system import System
from exploit.variable import Variable

def parse_args():
    parser = argparse.ArgumentParser()
    args = parser.parse_args()
    return args

def main():
    args = parse_args()

    try:
        o = Task([
            Assign('x', 10)
        ])
        t = Task([
            Assign('x', 1)
        ], dependencies=o)
        t = Task([
            Assign('y', 1)
        ], dependencies=t)
        x = Task([
            Assign('z', 1)
        ], dependencies=o)
        x = Task([
            Assign('z', 5)
        ], dependencies=x)
        tSomme = Task([
            Add('x', 'y', 'z')
        ], name="Somme", dependencies=[t, x])

        system = System(tasks=Task.Tasks)
        system.draw('graph', view=True)
        seq = System.sequentialize(tasks=Task.Tasks)
        seq.draw('sequential', view=True)

    except (RuntimeError, ValueError) as e:
        print('ERREUR :', e)
        print('ERREUR :', e.__doc__)

if __name__ == '__main__':
    main()