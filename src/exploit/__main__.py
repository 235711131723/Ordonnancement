#!/usr/bin/env python3

from rich import print
import argparse
import toposort

from exploit.task import Task
from exploit.instruction import Assign, Add, Sub
from exploit.system import System
from exploit.variable import Variable

def parse_args():
    parser = argparse.ArgumentParser()
    args = parser.parse_args()
    return args

def main():
    args = parse_args()

    try:
        t1 = Task([
            Assign('x', 1)
        ])
        t2 = Task([
            Assign('y', 1)
        ], dependencies=[t1])
        t3 = Task([
            Assign('z', 1)
        ], dependencies=[])
        t4 = Task([
            Assign('z', 5)
        ], dependencies=[t3])
        tSomme = Task([
            Add('x', 'y', 'z')
        ], name="Somme", dependencies=[t4, t2])

        s = System(tasks=Task.Tasks)
        s.draw('normal', True)

        print(toposort.toposort_flatten({task: task.dependencies for task in s.tasks}))
    except (RuntimeError, ValueError) as e:
        print('ERREUR :', e)
        print('ERREUR :', e.__doc__)

if __name__ == '__main__':
    main()